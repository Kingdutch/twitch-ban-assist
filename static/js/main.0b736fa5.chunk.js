(this["webpackJsonptwitch-ban-assist"]=this["webpackJsonptwitch-ban-assist"]||[]).push([[0],{15:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function r(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},16:function(e,t,n){"use strict";var r=n(0),a=n.n(r),c=n(1),l=n.n(c),o=n(6),u=n(3),i="ok7ldffjfrdafeme3x5jfob7rxhmlv",s=["chat:read","chat:edit","channel:moderate"];function m(){var e=Object(u.c)("access_token",f),t=e.isLoading,n=e.isError,r=e.data,a=e.error,c=function(e){return Object(u.c)([e,!1,"user_id"],h,{enabled:e})}(r),l=c.isLoading,o=c.isError,i=c.data,s=c.error;return{isLoading:t||l,isError:n||o,data:{token:r,user:"undefined"===typeof i?null:i},error:a||s}}function f(){return d.apply(this,arguments)}function d(){return(d=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=localStorage.getItem("token"))){e.next=6;break}if(null!==(t=b())){e.next=5;break}return e.abrupt("return",null);case 5:localStorage.setItem("token",t);case 6:return e.next=8,h(t);case 8:if(null!==e.sent){e.next=12;break}return localStorage.removeItem("token"),e.abrupt("return",null);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return p.apply(this,arguments)}function p(){return(p=Object(o.a)(l.a.mark((function e(t){var n,r,a,c,o,u,i,s,m,f=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.length>1&&void 0!==f[1]&&f[1],a=parseInt(null!==(n=localStorage.getItem("validation_time"))&&void 0!==n?n:0,10),c=localStorage.getItem("user_id"),o=localStorage.getItem("user_name"),r||!(a>Date.now()-36e5)||null===c){e.next=6;break}return e.abrupt("return",{user_id:c,user_name:o});case 6:return e.next=8,fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth ".concat(t)}});case 8:if((u=e.sent).ok){e.next=11;break}return e.abrupt("return",null);case 11:return e.prev=11,e.next=14,u.json();case 14:return i=e.sent,s="undefined"!==typeof i.user_id?i.user_id:null,m="undefined"!==typeof i.login?i.login:null,localStorage.setItem("user_id",s),localStorage.setItem("user_name",m),localStorage.setItem("validation_time",Date.now().toString()),e.abrupt("return",null===s||null===m?null:{user_id:s,user_name:m});case 23:return e.prev=23,e.t0=e.catch(11),e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,null,[[11,23]])})))).apply(this,arguments)}function b(){var e=window.location.hash;if(e.length<=1)return null;var t=function(e){for(var t={},n=("?"===e[0]?e.substr(1):e).split("&"),r=0,a=n.length;r<a;r++){var c=n[r].split("=");t[decodeURIComponent(c[0])]=decodeURIComponent(c[1]||"")}return t}(e.substr(1));return"undefined"===typeof t.access_token||"undefined"===typeof t.token_type||"bearer"!==t.token_type?null:(window.location.hash="",t.access_token)}n(27);var E=function(){var e="https://id.twitch.tv/oauth2/authorize?client_id=".concat(i,"&redirect_uri=").concat(encodeURIComponent("https://kingdutch.github.io/twitch-ban-assist/"),"&response_type=token&scope=").concat(s.join(" "));return a.a.createElement("main",{className:"Anonymous"},a.a.createElement("p",null,"You must authenticate with Twitch to use this tool."),a.a.createElement("p",null,"The tool will request the following permissions:",a.a.createElement("ul",null,a.a.createElement("li",null,"Read and Write chat messages ",a.a.createElement("br",null)," ",a.a.createElement("span",{className:"i"},"required to be able to issue commands such as ban to Twitch.")),a.a.createElement("li",null,"Perform moderation tasks on your behalf ",a.a.createElement("br",null)," ",a.a.createElement("span",{className:"i"},"required to automatically ban users in the channel you're a moderator in.")))),a.a.createElement("p",{className:"center"},a.a.createElement("a",{href:e,className:"btn btn-primary"},"Authenticate")))},g=n(2),v=n(17);function j(e){return w.apply(this,arguments)}function w(){return(w=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://modlookup.3v.fi/api/user-v3/".concat(t,"?limit=10000"));case 2:if((n=e.sent).ok){e.next=5;break}throw new Error(n.statusText);case 5:return e.next=7,n.json();case 7:return r=e.sent,e.abrupt("return",(r.channels||[]).map((function(e){return e.name})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(28);var k=n(4),O=n(5);function y(e){var t=(e||"").toLowerCase();return"#"===t[0]?t:"#"+t}var _=function(e){var t=e.chatClient,n=e.channels,c=e.user_name,l=Object(r.useMemo)((function(){return Object.fromEntries(n.map((function(e){return[y(e),e]})))}),[n]),o=Object(r.useState)({}),u=Object(g.a)(o,2),i=u[0],s=u[1];Object(r.useEffect)((function(){var e=function(e,t){t===c&&s((function(t){return Object(O.a)({},t,Object(k.a)({},l[e],!1))}))};return t.on("join",e),function(){t.off("join",e)}}),[t,s,c,l]);var m=Object(r.useState)({target_user:"",reason:""}),f=Object(g.a)(m,2),d=f[0],h=f[1],p=Object(r.useState)({}),b=Object(g.a)(p,2),E=b[0],v=b[1],j=Object.entries(i).every((function(e){var t=Object(g.a)(e,2);t[0];return t[1]})),w=n.map((function(e){var t,n,r="undefined"!==typeof i[e];return a.a.createElement("tr",{key:e},a.a.createElement("td",null,a.a.createElement("input",{type:"checkbox",value:e,disabled:!r,checked:null!==(t=i[e])&&void 0!==t&&t,onChange:function(){return s((function(t){return Object(O.a)({},t,Object(k.a)({},e,!t[e]))}))}})),a.a.createElement("td",null,e),a.a.createElement("td",null,r?null!==(n=E[y(e)])&&void 0!==n?n:"":"Joining channel..."))}));return a.a.createElement(a.a.Fragment,null,a.a.createElement("table",{className:"table-select"},a.a.createElement("caption",null,"Select streams to apply ban to"),a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,a.a.createElement("input",{type:"checkbox",checked:j,onChange:function(){return s((function(e){return Object.fromEntries(Object.entries(e).map((function(e){var t=Object(g.a)(e,2),n=t[0];t[1];return[n,!j]})))}))}})),a.a.createElement("th",null,"Broadcaster"),a.a.createElement("th",null,"Status"))),a.a.createElement("tbody",null,w)),a.a.createElement("p",null,a.a.createElement("label",null,"Username",a.a.createElement("br",null),a.a.createElement("input",{type:"text",required:!0,value:d.target_user,onChange:function(e){var t=e.target.value;h((function(e){return Object(O.a)({},e,{target_user:t})}))}}))),a.a.createElement("p",null,a.a.createElement("label",null,"Reason",a.a.createElement("br",null),a.a.createElement("input",{value:d.reason,type:"text",onChange:function(e){var t=e.target.value;h((function(e){return Object(O.a)({},e,{reason:t})}))}}))),a.a.createElement("p",null,a.a.createElement("button",{disabled:0===d.target_user.length,onClick:function(){var e=d.target_user,n=d.reason;h({target_user:"",reason:""});var r=Object.fromEntries(Object.entries(i).filter((function(e){var t=Object(g.a)(e,2);t[0];return t[1]})).map((function(t){var n=Object(g.a)(t,2),r=n[0];n[1];return[r,"Banning ".concat(e,"...")]})));v(r);for(var a=function(){var r=y(l[c]);t.ban(r,e,n).then((function(){return v((function(t){return Object(O.a)({},t,Object(k.a)({},r,"Banned ".concat(e)))}))})).catch((function(e){return v((function(t){return Object(O.a)({},t,Object(k.a)({},r,"Error ".concat(e)))}))}))},c=0,l=Object.keys(r);c<l.length;c++)a()},className:"btn btn-primary"},"Ban")))},x=n(14),S=null;function C(e,t,n,r){null===S&&null!==e&&null!==t&&0!==n.length&&(S=function(e,t,n){return new x.Client({options:{debug:!1},connection:{reconnect:!1,secure:!0},identity:{username:t,password:"oauth:".concat(e)},channels:n,logger:{info:function(){return null},warn:console.warn,error:console.error}})}(e,t,n)).connect().then((function(){r({error:null,client:S})})).catch((function(e){r({error:e,client:null})}))}var I=function(e){var t=e.token,n=e.user_name,c=function(e){var t=Object(u.c)([e,"user_follows"],j,{staleTime:432e5}),n=t.isLoading,r=t.isError,a=t.data,c=t.error;return n||r||(a=[].concat(Object(v.a)(a),[e])),{isLoading:n,isError:r,data:a,error:c}}(n),l=c.isLoading,o=c.isError,i=c.data,s=c.error,m=Object(r.useState)({error:null,client:null}),f=Object(g.a)(m,2),d=f[0],h=d.error,p=d.client,b=f[1],E=Object(r.useRef)(null);if(E.current=p,Object(r.useEffect)((function(){return function(){null!==E.current&&(E.current.disconnect(),E.current=null)}}),[E]),l)return a.a.createElement("p",null,"Loading follower list.....");if(o)return a.a.createElement("p",null,"Error loading follower list: ",s.message);C(t,n,i,b);var w=a.a.createElement("p",null,"Logged in as: ",n);return null===h&&null===p?a.a.createElement(a.a.Fragment,null,w,a.a.createElement("p",null,"Connecting to chatserver....")):null!==h?a.a.createElement(a.a.Fragment,null,w,a.a.createElement("p",null,"Error connecting to chatserver: ",h.message)):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"banner"},"This tool uses the ",a.a.createElement("a",{href:"https://modlookup.3v.fi/",target:"_blank",rel:"noopener noreferrer"},"Mod Lookup")," tool which updates once a day. If you were recently modded in a channel it may take some time to show up."),w,a.a.createElement(_,{chatClient:p,channels:i,user_name:n}))};var L=function(){var e=m(),t=e.isLoading,n=e.isError,r=e.data,c=r.user,l=r.token,o=e.error;return t?a.a.createElement("p",null,"Loading..."):n?a.a.createElement("p",null,"Unexpected error while authenticating: ",o.message):null===c?a.a.createElement(E,null):a.a.createElement("main",{className:"Authenticated"},a.a.createElement(I,{user_id:c.user_id,user_name:c.user_name,token:l}))};n(44);var N=function(){return a.a.createElement("footer",{className:"Footer"},a.a.createElement("span",null,"\xa9 Copyright 2020 - Kingdutch"),a.a.createElement("span",null,a.a.createElement("a",{href:"https://github.com/Kingdutch/twitch-ban-assist/"},"Open Source on GitHub")))};t.a=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(L,null),a.a.createElement(N,null))}},18:function(e,t,n){e.exports=n(19)},19:function(e,t,n){"use strict";n.r(t),function(e){var t=n(0),r=n.n(t),a=n(9),c=n.n(a),l=n(3),o=(n(24),n(25),n(16)),u=n(15),i=new l.a;"undefined"!==typeof e.setMaxListeners&&e.setMaxListeners(0),c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(l.b,{queryCache:i},r.a.createElement(o.a,null))),document.getElementById("root")),u.a()}.call(this,n(11))},24:function(e,t,n){},25:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},32:function(e,t){},43:function(e,t){},44:function(e,t,n){}},[[18,1,2]]]);
//# sourceMappingURL=main.0b736fa5.chunk.js.map